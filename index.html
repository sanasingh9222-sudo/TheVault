<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>The Vault</title>
    <style>
        :root { --bg: #000; --card: #1c1c1e; --accent: #0A84FF; --text: #fff; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        h1 { font-size: 26px; font-weight: 700; margin: 10px 0 30px 0; }
        .category-section { margin-bottom: 30px; }
        .category-title { font-size: 13px; color: #8e8e93; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; font-weight: 600; border-bottom: 1px solid #2c2c2e; padding-bottom: 5px; }
        .tile-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .tile { background: var(--card); border-radius: 14px; text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; aspect-ratio: 1 / 1; border: 1px solid #2c2c2e; }
        .tile-icon { font-size: 18px; font-weight: 700; color: var(--accent); background: #2c2c2e; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; border-radius: 10px; margin-bottom: 6px; }
        .tile-name { font-size: 11px; font-weight: 500; text-align: center; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    </style>
</head>
<body>
    <h1>The Vault</h1>
    <div id="vault-content">Connecting...</div>

    <script>
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSPHKADiAyC6YoAsqpE_Z_UhGvXws3gk0gNGY1WYqDl6CWdtVh8u_rb4xuZAE-WAdbjgxALYrGBGczy/pub?gid=0&single=true&output=csv'; // <--- ENSURE THIS ENDS IN output=csv

        async function loadVault() {
            try {
                const response = await fetch(sheetUrl);
                const text = await response.text();
                
                // Break text into lines and clean up whitespace
                const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);
                
                const categories = {};

                // Skip the first row (headers) and process the rest
                for (let i = 1; i < lines.length; i++) {
                    const cols = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    
                    if (cols.length >= 2) {
                        const name = cols[0].replace(/["']/g, "").trim();
                        const url = cols[1].replace(/["']/g, "").trim();
                        const cat = (cols[2] || "Uncategorized").replace(/["']/g, "").trim();

                        // SKIP junk rows (if name is "0" or "arial" or too short)
                        if (name.toLowerCase() === "arial" || name === "0" || !url.startsWith("http")) {
                            continue; 
                        }

                        if (!categories[cat]) categories[cat] = [];
                        categories[cat].push({ name, url });
                    }
                }

                const content = document.getElementById('vault-content');
                content.innerHTML = '';

                Object.keys(categories).sort().forEach(title => {
                    let html = `<div class="category-section"><div class="category-title">${title}</div><div class="tile-grid">`;
                    categories[title].forEach(link => {
                        const initials = link.name.substring(0, 2).toUpperCase();
                        html += `<a href="${link.url}" class="tile" target="_blank"><div class="tile-icon">${initials}</div><div class="tile-name">${link.name}</div></a>`;
                    });
                    html += `</div></div>`;
                    content.innerHTML += html;
                });

            } catch (err) {
                document.getElementById('vault-content').innerHTML = "Error loading. Check CSV link.";
            }
        }
        loadVault();
    </script>
</body>
</html>
